<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   FaceID Voting - Registration
  </title>
  <!-- Brand font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Font Awesome 6 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <!-- Global Theme CSS -->
  <link href="static/style.css" rel="stylesheet"/>
  <!-- Page-specific CSS -->
  <link href="static/registration_page.css" rel="stylesheet"/>
 </head>
 <body style="font-family: Poppins, var(--font-sans);">
  <!-- Shared/Public Header with branding and minimal actions -->
  <style>
   .app-header-shared{background:#6144a6;color:#fff}
    .app-header-shared .navbar-brand,.app-header-shared .nav-link,.app-header-shared .dropdown-toggle{color:#fff}
    .app-header-shared .nav-link:hover,.app-header-shared .dropdown-item:hover{opacity:.9}
  </style>
  <nav class="navbar navbar-expand-lg app-header-shared shadow-sm">
   <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="./index.html">
     <img alt="Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/brandlogo/80/28';" src="https://dsaishared.blob.core.windows.net/uxcceleratecontainer/projects/68bd9542e1229daa603ec466/logos/logo_94009328-59f7-426f-bafe-3182305ed5e5.webp" style="height:28px;"/>
     FaceID Voting
    </a>
    <button aria-controls="sharedNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#sharedNav" data-bs-toggle="collapse" type="button">
     <span class="navbar-toggler-icon">
     </span>
    </button>
    <div class="collapse navbar-collapse" id="sharedNav">
     <ul class="navbar-nav ms-auto align-items-center">
      <li class="nav-item me-2">
       <a class="btn btn-light btn-sm" href="./index.html">
        <i class="fa-solid fa-right-to-bracket me-1">
        </i>
        Login
       </a>
      </li>
      <li class="nav-item">
       <a class="btn btn-outline-light btn-sm" href="./registration_page.html">
        <i class="fa-solid fa-user-plus me-1">
        </i>
        Register
       </a>
      </li>
     </ul>
    </div>
   </div>
  </nav>
  <div class="container-fluid">
   <div class="row g-0">
    <!-- Shared/Public Sidebar (suitable for public pages like Registration). Hidden on small screens. -->
    <style>
     :root { --primary-color:#6144a6; --secondary-color:#ffffff; --hover-bg: rgba(97,68,166,.08); --active-bg: rgba(97,68,166,.14); }
        .app-sidebar-shared{width:260px;background:#fff;border-right:1px solid #eee;}
        .app-sidebar-shared .brand-block{background:var(--secondary-color);border-bottom:1px solid #eee}
        .app-sidebar-shared .brand-title{color:#333;font-weight:600}
        .app-sidebar-shared .nav-link{color:#444;border-radius:.35rem;padding:.5rem .75rem}
        .app-sidebar-shared .nav-link:hover{background:var(--hover-bg);color:#222}
        .app-sidebar-shared .nav-link.active{background:var(--active-bg);color:#222}
        @media (max-width: 991.98px){ .app-sidebar-shared{display:none;} }
    </style>
    <aside class="app-sidebar-shared d-none d-lg-block col-auto">
     <div class="brand-block d-flex align-items-center p-3">
      <a class="d-flex align-items-center text-decoration-none" href="./index.html">
       <img alt="Brand Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/brandmark/84/28';" src="https://dsaishared.blob.core.windows.net/uxcceleratecontainer/projects/68bd9542e1229daa603ec466/logos/logo_94009328-59f7-426f-bafe-3182305ed5e5.webp" style="height:28px;width:auto;">
        <span class="brand-title">
         FaceID Voting
        </span>
       </img>
      </a>
     </div>
     <div class="p-3">
      <div class="d-flex align-items-center mb-3">
       <div class="rounded-circle bg-light d-flex align-items-center justify-content-center me-2" style="width:40px;height:40px;">
        <i class="fa-solid fa-user text-muted">
        </i>
       </div>
       <div>
        <div class="fw-semibold">
         Welcome
        </div>
        <div class="text-muted small">
         Guest
        </div>
       </div>
      </div>
      <small class="text-uppercase text-muted">
       Getting Started
      </small>
      <ul class="nav flex-column mt-2 mb-3">
       <li class="nav-item">
        <a class="nav-link active" href="./registration_page.html">
         <i class="fa-solid fa-user-plus me-2">
         </i>
         Register
        </a>
       </li>
       <li class="nav-item">
        <a class="nav-link" href="./index.html">
         <i class="fa-solid fa-right-to-bracket me-2">
         </i>
         Login
        </a>
       </li>
       <li class="nav-item">
        <a class="nav-link" href="./email_verification.html">
         <i class="fa-solid fa-envelope-open-text me-2">
         </i>
         Email Verification
        </a>
       </li>
      </ul>
      <small class="text-uppercase text-muted">
       Support
      </small>
      <ul class="nav flex-column mt-2">
       <li class="nav-item">
        <a class="nav-link" href="#" onclick="return false;">
         <i class="fa-solid fa-circle-question me-2">
         </i>
         Help
        </a>
       </li>
       <li class="nav-item">
        <a class="nav-link" href="./privacy.html">
         <i class="fa-solid fa-shield-halved me-2">
         </i>
         Privacy Policy
        </a>
       </li>
       <li class="nav-item">
        <a class="nav-link" href="./terms.html">
         <i class="fa-solid fa-scale-balanced me-2">
         </i>
         Terms
        </a>
       </li>
      </ul>
     </div>
    </aside>
    <!-- Main content -->
    <main class="col">
     <div class="container-max py-4 py-lg-5">
      <div class="page-header">
       <div class="d-flex align-items-center gap-2">
        <span class="badge-soft primary">
         <i class="fa-solid fa-id-card-clip">
         </i>
         Register Voter
        </span>
       </div>
      </div>
      <!-- System Feedback Area -->
      <div class="alert alert-info d-none" id="feedbackArea" role="alert">
       <i class="fa-solid fa-circle-info me-1">
       </i>
       We use your facial image only for identity verification. Please ensure good lighting.
      </div>
      <div class="app-card login-form-container registration-shell">
       <div class="card-header">
        <div class="title d-flex align-items-center gap-2">
         <i class="fa-solid fa-user-plus text-primary">
         </i>
         <span class="widget-title">
          Create your account
         </span>
        </div>
        <div class="text-muted small">
         Step 1 of Register Voter
        </div>
       </div>
       <div class="card-body">
        <form id="registrationForm" novalidate="">
         <div class="row g-4">
          <!-- User Details -->
          <div class="col-12 col-lg-6">
           <h6 class="text-muted text-uppercase mb-3">
            Your Details
           </h6>
           <div class="mb-3">
            <label class="form-label" for="fullName">
             Full Name
            </label>
            <div class="input-group">
             <span class="input-group-text">
              <i class="fa-regular fa-user">
              </i>
             </span>
             <input class="form-control" id="fullName" name="fullName" placeholder="Enter your full name" required="" type="text"/>
            </div>
            <div class="invalid-feedback" id="fullNameError">
             Please enter a valid name (letters and spaces only).
            </div>
           </div>
           <div class="mb-3">
            <label class="form-label" for="uniqueId">
             Unique ID
            </label>
            <div class="input-group">
             <span class="input-group-text">
              <i class="fa-solid fa-id-badge">
              </i>
             </span>
             <input class="form-control" id="uniqueId" name="uniqueId" placeholder="Enter your Student/Employee ID" required="" type="text"/>
            </div>
            <div class="invalid-feedback" id="uniqueIdError">
             Please enter a valid alphanumeric ID.
            </div>
           </div>
           <div class="mb-3">
            <label class="form-label" for="email">
             Email Address
            </label>
            <div class="input-group">
             <span class="input-group-text">
              <i class="fa-regular fa-envelope">
              </i>
             </span>
             <input class="form-control" id="email" name="email" placeholder="Enter your email address" required="" type="email"/>
            </div>
            <div class="invalid-feedback" id="emailError">
             Please enter a valid email (e.g., user@domain.com).
            </div>
           </div>
           <div class="alert alert-warning small" role="alert">
            <i class="fa-solid fa-shield-halved me-1">
            </i>
            We will send a verification link to your email after registration.
           </div>
          </div>
          <!-- Face Capture -->
          <div class="col-12 col-lg-6">
           <h6 class="text-muted text-uppercase mb-3">
            Face Capture
           </h6>
           <div class="camera-panel border rounded p-3">
            <div class="camera-container" id="cameraContainer">
             <video autoplay="" class="camera-frame" id="liveVideo" muted="" playsinline="">
             </video>
             <div aria-hidden="true" class="overlay-guide d-none d-md-block">
             </div>
             <div class="camera-controls mt-3 d-flex gap-2">
              <button class="btn btn-light" id="startCameraBtn" type="button">
               <i class="fa-solid fa-camera">
               </i>
               Start Camera
              </button>
              <button class="btn btn-primary" disabled="" id="captureBtn" type="button">
               <i class="fa-solid fa-circle-dot">
               </i>
               Take Photo
              </button>
              <button class="btn btn-outline-secondary d-none" id="retakeBtn" type="button">
               <i class="fa-solid fa-rotate-left">
               </i>
               Retake
              </button>
             </div>
            </div>
            <div class="preview-container d-none mt-3" id="previewContainer">
             <img alt="Captured face preview" class="img-fluid rounded border" id="capturedImg" onerror="this.onerror=null;this.src='https://picsum.photos/seed/facefallback/480/320';"/>
            </div>
            <canvas class="d-none" id="snapshotCanvas">
            </canvas>
            <div class="text-muted small mt-2" id="cameraStatus">
            </div>
           </div>
          </div>
         </div>
         <!-- Actions -->
         <div class="submit-action-footer d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
          <div class="small text-muted">
           By creating an account, you agree to our
           <a href="./terms.html">
            Terms
           </a>
           and
           <a href="./privacy.html">
            Privacy Policy
           </a>
           .
          </div>
          <div class="d-flex align-items-center gap-2">
           <a class="btn btn-light" href="./index.html">
            <i class="fa-solid fa-arrow-left-long me-1">
            </i>
            Back to Login
           </a>
           <button class="btn btn-primary" disabled="" id="registerBtn" type="submit">
            <span class="btn-label">
             <i class="fa-solid fa-user-check me-1">
             </i>
             Create Account
            </span>
            <span aria-hidden="true" class="spinner-border spinner-border-sm ms-2 d-none" id="registerSpinner" role="status">
            </span>
           </button>
          </div>
         </div>
        </form>
       </div>
      </div>
      <!-- Helpful info / FAQ link -->
      <div class="mt-3 text-center text-muted small">
       Need help?
       <a href="#" onclick="return false;">
        Read registration tips
       </a>
      </div>
     </div>
    </main>
   </div>
  </div>
  <!-- Shared/Public Footer -->
  <style>
   .app-footer{background:#f8f9fa;border-top:1px solid #eee;color:#555}
    .app-footer a{color:#6144a6;text-decoration:none}
    .app-footer a:hover{text-decoration:underline}
  </style>
  <footer class="app-footer py-3 mt-auto">
   <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between">
    <div class="d-flex align-items-center mb-2 mb-md-0">
     <img alt="Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/footerlogo/60/20';" src="https://dsaishared.blob.core.windows.net/uxcceleratecontainer/projects/68bd9542e1229daa603ec466/logos/logo_94009328-59f7-426f-bafe-3182305ed5e5.webp" style="height:20px"/>
     <small>
      © 2025 FaceID Voting
     </small>
    </div>
    <div class="d-flex gap-3">
     <a class="small" href="./terms.html">
      Terms
     </a>
     <a class="small" href="./privacy.html">
      Privacy
     </a>
     <a class="small" href="#" onclick="return false;">
      Support
     </a>
    </div>
   </div>
  </footer>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11">
  </script>
  <!-- Bootstrap 5 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
  </script>
  <!-- Page JS -->
  <script>
   (function() {
    const form = document.getElementById('registrationForm');
    const fullName = document.getElementById('fullName');
    const uniqueId = document.getElementById('uniqueId');
    const email = document.getElementById('email');
    const registerBtn = document.getElementById('registerBtn');
    const registerSpinner = document.getElementById('registerSpinner');

    const startCameraBtn = document.getElementById('startCameraBtn');
    const captureBtn = document.getElementById('captureBtn');
    const retakeBtn = document.getElementById('retakeBtn');
    const liveVideo = document.getElementById('liveVideo');
    const snapshotCanvas = document.getElementById('snapshotCanvas');
    const previewContainer = document.getElementById('previewContainer');
    const capturedImg = document.getElementById('capturedImg');
    const cameraStatus = document.getElementById('cameraStatus');

    const state = {
        isWebcamActive: false,
        stream: null,
        capturedImage: null
    };

    function sanitize(input) {
        return input.replace(/[<>"']/g, '');
    }

    function validateName(value) {
        const v = value.trim();
        return v.length > 0 && /^[A-Za-z ]+$/.test(v);
    }

    function validateUniqueId(value) {
        const v = value.trim();
        return v.length > 0 && /^[A-Za-z0-9]+$/.test(v);
    }

    function validateEmail(value) {
        const v = value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(v);
    }

    function updateSubmitState() {
        const ok = validateName(fullName.value) && validateUniqueId(uniqueId.value) && validateEmail(email.value) && !!state.capturedImage;
        registerBtn.disabled = !ok;
    }

    function setInvalid(el, errorId, isInvalid) {
        if (isInvalid) {
            el.classList.add('is-invalid');
            document.getElementById(errorId).style.display = 'block';
        } else {
            el.classList.remove('is-invalid');
            document.getElementById(errorId).style.display = 'none';
        }
    }

    // Input events
    fullName.addEventListener('blur', () => {
        setInvalid(fullName, 'fullNameError', !validateName(fullName.value));
        updateSubmitState();
    });
    uniqueId.addEventListener('blur', () => {
        setInvalid(uniqueId, 'uniqueIdError', !validateUniqueId(uniqueId.value));
        updateSubmitState();
    });
    email.addEventListener('blur', () => {
        setInvalid(email, 'emailError', !validateEmail(email.value));
        updateSubmitState();
    });
    [fullName, uniqueId, email].forEach(el => el.addEventListener('input', updateSubmitState));

    // Webcam handling
    async function startCamera() {
        try {
            if (state.stream) {
                return;
            }
            const stream = await navigator.mediaDevices.getUserMedia({
                video: {
                    facingMode: 'user'
                },
                audio: false
            });
            state.stream = stream;
            liveVideo.srcObject = stream;
            state.isWebcamActive = true;
            captureBtn.disabled = false;
            cameraStatus.textContent = 'Camera is active. Position your face within the guide and click Take Photo.';
        } catch (err) {
            state.isWebcamActive = false;
            captureBtn.disabled = true;
            cameraStatus.innerHTML = 'Could not access the camera. Please check browser permissions.';
            Swal.fire({
                icon: 'error',
                title: 'Camera Access Denied',
                text: 'We could not access your webcam. Please grant permission and try again.'
            });
        }
    }

    function stopCamera() {
        if (state.stream) {
            state.stream.getTracks().forEach(t => t.stop());
            state.stream = null;
        }
        state.isWebcamActive = false;
        captureBtn.disabled = true;
    }

    function capturePhoto() {
        if (!state.isWebcamActive || !liveVideo.videoWidth) {
            return;
        }
        const w = liveVideo.videoWidth;
        const h = liveVideo.videoHeight;
        snapshotCanvas.width = w;
        snapshotCanvas.height = h;
        const ctx = snapshotCanvas.getContext('2d');
        ctx.drawImage(liveVideo, 0, 0, w, h);
        const dataUrl = snapshotCanvas.toDataURL('image/jpeg', 0.9);
        state.capturedImage = dataUrl;
        capturedImg.src = dataUrl;
        previewContainer.classList.remove('d-none');
        retakeBtn.classList.remove('d-none');
        cameraStatus.textContent = 'Photo captured. If you are not satisfied, click Retake.';
        updateSubmitState();
    }

    function retakePhoto() {
        state.capturedImage = null;
        previewContainer.classList.add('d-none');
        retakeBtn.classList.add('d-none');
        cameraStatus.textContent = 'Camera is active. Position your face and click Take Photo.';
        updateSubmitState();
    }

    startCameraBtn.addEventListener('click', startCamera);
    captureBtn.addEventListener('click', capturePhoto);
    retakeBtn.addEventListener('click', retakePhoto);

    // Show informational feedback on load
    const feedbackArea = document.getElementById('feedbackArea');
    feedbackArea.classList.remove('d-none');

    // Submit handler
    form.addEventListener('submit', function(e) {
        e.preventDefault();

        // final validation
        const nameOk = validateName(fullName.value);
        const idOk = validateUniqueId(uniqueId.value);
        const emailOk = validateEmail(email.value);
        setInvalid(fullName, 'fullNameError', !nameOk);
        setInvalid(uniqueId, 'uniqueIdError', !idOk);
        setInvalid(email, 'emailError', !emailOk);
        if (!(nameOk && idOk && emailOk && state.capturedImage)) {
            Swal.fire({
                icon: 'warning',
                title: 'Complete Required Fields',
                text: 'Please ensure all fields are valid and a face photo is captured.'
            });
            return;
        }

        // disable UI / show loading
        registerBtn.disabled = true;
        registerSpinner.classList.remove('d-none');
        [fullName, uniqueId, email, startCameraBtn, captureBtn, retakeBtn].forEach(el => el.disabled = true);

        const payload = {
            fullName: sanitize(fullName.value),
            uniqueId: sanitize(uniqueId.value),
            email: sanitize(email.value),
            faceImage: state.capturedImage
        };

        // Simulate API call
        setTimeout(() => {
            registerSpinner.classList.add('d-none');
            Swal.fire({
                icon: 'success',
                title: 'Registration Submitted',
                html: 'We have sent a verification link to <b>' + payload.email + '</b>. Please verify to continue.',
                confirmButtonText: 'Go to Email Verification',
                confirmButtonColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary') || '#6144a6'
            }).then(() => {
                window.location.href = './email_verification.html';
            });
        }, 1200);
    });

    // Cleanup camera when leaving
    window.addEventListener('beforeunload', stopCamera);
})();
  </script>
 </body>
</html>
