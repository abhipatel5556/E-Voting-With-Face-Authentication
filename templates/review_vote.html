<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Review Your Vote - FaceID Voting
  </title>
  <!-- Google Font: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <!-- Bootstrap 5 CSS -->
  <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" rel="stylesheet"/>
  <!-- Font Awesome 6 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
   <!-- Site Theme CSS -->
   <link href="static/style.css" rel="stylesheet">
    <!-- Page-specific CSS -->
    <link href="static/review_vote.css" rel="stylesheet"/>
   </link>
  </link>
 </head>
 <body>
  <!-- Header (Common Component) -->
  <nav class="navbar navbar-expand-lg app-header-voter shadow-sm">
   <div class="container-fluid">
    <button aria-controls="appSidebarVoter" aria-expanded="false" aria-label="Toggle sidebar" class="btn btn-outline-light d-lg-none me-2" data-bs-target="#appSidebarVoter" data-bs-toggle="collapse" type="button">
     <i class="fa-solid fa-bars">
     </i>
    </button>
    <a class="navbar-brand d-flex align-items-center" href="./voter_dashboard.html">
     <img alt="Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/faceidvote/56/28';" src="https://dsaishared.blob.core.windows.net/uxcceleratecontainer/projects/68bd9542e1229daa603ec466/logos/logo_94009328-59f7-426f-bafe-3182305ed5e5.webp" style="height:28px;"/>
     Voter Portal
    </a>
    <button aria-controls="voterNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#voterNav" data-bs-toggle="collapse" type="button">
     <span class="navbar-toggler-icon">
     </span>
    </button>
    <div class="collapse navbar-collapse" id="voterNav">
     <form action="./voter_dashboard.html" class="d-none d-md-flex ms-auto me-3" role="search">
      <div class="input-group input-group-sm">
       <span class="input-group-text">
        <i class="fa-solid fa-magnifying-glass">
        </i>
       </span>
       <input aria-label="Search elections" class="form-control" name="q" placeholder="Search elections" type="search"/>
      </div>
     </form>
     <ul class="navbar-nav align-items-center">
      <li class="nav-item me-2 d-none d-md-block">
       <a class="btn btn-light btn-sm" href="./voter_dashboard.html#active">
        <i class="fa-solid fa-check-to-slot me-1">
        </i>
        Active Elections
       </a>
      </li>
      <li class="nav-item me-2 position-relative">
       <a aria-label="Notifications" class="nav-link" href="#">
        <i class="fa-regular fa-bell">
        </i>
        <span class="notif-dot">
        </span>
       </a>
      </li>
      <li class="nav-item dropdown">
       <a aria-expanded="false" class="nav-link dropdown-toggle d-flex align-items-center" data-bs-toggle="dropdown" href="#" id="voterProfileMenu" role="button">
        <img alt="Avatar" class="rounded-circle me-2" src="https://www.gravatar.com/avatar?d=mp&amp;s=40" style="width:28px;height:28px"/>
        <span>
         John Doe
        </span>
       </a>
       <ul class="dropdown-menu dropdown-menu-end">
        <li>
         <h6 class="dropdown-header">
          Voter
         </h6>
        </li>
        <li>
         <a class="dropdown-item" href="#" onclick="return false;">
          <i class="fa-solid fa-gear me-2">
          </i>
          Settings
         </a>
        </li>
        <li>
         <a class="dropdown-item" href="#" onclick="return false;">
          <i class="fa-solid fa-circle-question me-2">
          </i>
          Help
         </a>
        </li>
        <li>
         <hr class="dropdown-divider"/>
        </li>
        <li>
         <a class="dropdown-item" href="./index.html">
          <i class="fa-solid fa-right-from-bracket me-2">
          </i>
          Logout
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
   </div>
  </nav>
  <div class="d-flex min-vh-100">
   <!-- Sidebar (Common Component) -->
   <aside class="app-sidebar-voter collapse d-lg-block" id="appSidebarVoter">
    <div class="brand d-flex align-items-center p-3">
     <a class="text-decoration-none d-flex align-items-center" href="./voter_dashboard.html">
      <img alt="Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/brand/52/26';" src="https://dsaishared.blob.core.windows.net/uxcceleratecontainer/projects/68bd9542e1229daa603ec466/logos/logo_94009328-59f7-426f-bafe-3182305ed5e5.webp" style="height:26px"/>
      <span class="fw-semibold text-dark">
       FaceID Voting
      </span>
     </a>
    </div>
    <div class="p-3">
     <div class="d-flex align-items-center mb-3">
      <img alt="User Avatar" class="rounded-circle me-2" src="https://www.gravatar.com/avatar?d=mp&amp;s=64" style="width:40px;height:40px"/>
      <div>
       <div class="fw-semibold" id="voterName">
        John Doe
       </div>
       <div class="text-muted small">
        Voter
       </div>
      </div>
     </div>
     <div class="mb-2 section-title text-uppercase">
      Overview
     </div>
     <ul class="nav flex-column mb-3">
      <li class="nav-item">
       <a class="nav-link" href="./voter_dashboard.html">
        <i class="fa-solid fa-gauge-high fa-fw me-2">
        </i>
        Dashboard
       </a>
      </li>
     </ul>
     <div class="mb-2 section-title text-uppercase">
      Elections
     </div>
     <ul class="nav flex-column mb-3">
      <li class="nav-item">
       <a class="nav-link" href="./voter_dashboard.html#active">
        <i class="fa-solid fa-check-to-slot fa-fw me-2">
        </i>
        Active Elections
       </a>
      </li>
      <li class="nav-item">
       <a class="nav-link" href="./voter_dashboard.html#completed">
        <i class="fa-solid fa-square-poll-horizontal fa-fw me-2">
        </i>
        Completed &amp; Results
       </a>
      </li>
     </ul>
     <div class="mb-2 section-title text-uppercase">
      Help
     </div>
     <ul class="nav flex-column">
      <li class="nav-item">
       <a class="nav-link" href="#" onclick="return false;">
        <i class="fa-solid fa-circle-question fa-fw me-2">
        </i>
        How to Vote
       </a>
      </li>
      <li class="nav-item">
       <a class="nav-link" href="./privacy.html">
        <i class="fa-solid fa-shield-halved fa-fw me-2">
        </i>
        Privacy
       </a>
      </li>
     </ul>
    </div>
   </aside>
   <!-- Main Content -->
   <main class="flex-grow-1">
    <div class="container py-4">
     <!-- Breadcrumb -->
     <nav aria-label="breadcrumb" class="breadcrumb">
      <ol class="breadcrumb mb-2">
       <li class="breadcrumb-item">
        <a href="./voter_dashboard.html">
         Dashboard
        </a>
       </li>
       <li class="breadcrumb-item">
        <a href="./ballot_page.html">
         Ballot
        </a>
       </li>
       <li aria-current="page" class="breadcrumb-item active">
        Review Vote
       </li>
      </ol>
     </nav>
     <!-- Page Header -->
     <div class="page-header">
      <div class="d-flex align-items-center gap-2">
       <h1 class="page-title mb-0">
        Review Your Ballot
       </h1>
       <span class="badge-soft warning">
        Final Step
       </span>
      </div>
      <div class="view-switcher d-none d-md-inline-flex">
       <span class="option active">
        Summary
       </span>
       <span class="option">
        Details
       </span>
      </div>
     </div>
     <!-- System Notice -->
     <div class="alert alert-warning d-flex align-items-center" role="alert">
      <i class="fa-solid fa-triangle-exclamation me-2">
      </i>
      <div>
       Please verify your selections below. Casting your vote is irreversible.
      </div>
     </div>
     <!-- Vote Review Component Card -->
     <div class="card app-card review-card mx-auto">
      <div class="card-header">
       <div class="d-flex align-items-center gap-2">
        <i class="fa-solid fa-ballot-check text-primary">
        </i>
        <div class="widget-title">
         University Student Council Election 2025
        </div>
       </div>
       <span class="badge-soft info">
        <i class="fa-regular fa-clock me-1">
        </i>
        Closes: Mar 28, 2025 5:00 PM
       </span>
      </div>
      <div class="card-body">
       <h3 class="h5 mb-3">
        Your Selections
       </h3>
       <!-- Selected Candidates Grid -->
       <div class="row g-3">
        <div class="col-12 col-sm-6">
         <div class="selected-card d-flex align-items-center p-3 border rounded">
          <img alt="Alex Johnson" class="rounded-circle me-3" height="56" onerror="this.onerror=null;this.src='https://picsum.photos/seed/alex/80/80';" src="https://picsum.photos/id/1011/80/80" width="56"/>
          <div>
           <div class="fw-semibold">
            Alex Johnson
           </div>
           <div class="text-muted small">
            President
           </div>
          </div>
         </div>
        </div>
        <div class="col-12 col-sm-6">
         <div class="selected-card d-flex align-items-center p-3 border rounded">
          <img alt="Mia Chen" class="rounded-circle me-3" height="56" onerror="this.onerror=null;this.src='https://picsum.photos/seed/mia/80/80';" src="https://picsum.photos/id/1005/80/80" width="56"/>
          <div>
           <div class="fw-semibold">
            Mia Chen
           </div>
           <div class="text-muted small">
            Vice-President
           </div>
          </div>
         </div>
        </div>
        <div class="col-12 col-sm-6">
         <div class="selected-card d-flex align-items-center p-3 border rounded">
          <img alt="Samuel Ortiz" class="rounded-circle me-3" height="56" onerror="this.onerror=null;this.src='https://picsum.photos/seed/samuel/80/80';" src="https://picsum.photos/id/1012/80/80" width="56"/>
          <div>
           <div class="fw-semibold">
            Samuel Ortiz
           </div>
           <div class="text-muted small">
            Treasurer
           </div>
          </div>
         </div>
        </div>
        <div class="col-12 col-sm-6">
         <div class="selected-card d-flex align-items-center p-3 border rounded">
          <img alt="Priya Patel" class="rounded-circle me-3" height="56" onerror="this.onerror=null;this.src='https://picsum.photos/seed/priya/80/80';" src="https://picsum.photos/id/1001/80/80" width="56"/>
          <div>
           <div class="fw-semibold">
            Priya Patel
           </div>
           <div class="text-muted small">
            Secretary
           </div>
          </div>
         </div>
        </div>
        <div class="col-12 col-sm-6">
         <div class="selected-card d-flex align-items-center p-3 border rounded">
          <img alt="Jordan Lee" class="rounded-circle me-3" height="56" onerror="this.onerror=null;this.src='https://picsum.photos/seed/jordan/80/80';" src="https://picsum.photos/id/1009/80/80" width="56"/>
          <div>
           <div class="fw-semibold">
            Jordan Lee
           </div>
           <div class="text-muted small">
            Senate At-Large Seat 1
           </div>
          </div>
         </div>
        </div>
        <div class="col-12 col-sm-6">
         <div class="selected-card d-flex align-items-center p-3 border rounded">
          <div class="rounded-circle me-3 d-flex align-items-center justify-content-center bg-info-soft" style="width:56px;height:56px;">
           <i class="fa-solid fa-scale-balanced text-info">
           </i>
          </div>
          <div>
           <div class="fw-semibold">
            Measure A: Campus Green Fee
           </div>
           <div class="text-muted small">
            Your choice: For
           </div>
          </div>
         </div>
        </div>
       </div>
       <!-- Ballot Summary Table with sorting/filtering placeholder -->
       <div class="mt-4">
        <div class="d-flex align-items-center justify-content-between mb-2 flex-wrap gap-2">
         <div class="fw-semibold">
          Ballot Summary (read-only)
         </div>
         <div class="d-flex align-items-center gap-2">
          <div class="input-group input-group-sm" style="max-width:240px;">
           <span class="input-group-text">
            <i class="fa-solid fa-filter">
            </i>
           </span>
           <input aria-label="Filter" class="form-control" id="summaryFilter" placeholder="Filter by office or name" type="text"/>
          </div>
         </div>
        </div>
        <div class="table-responsive">
         <table class="table table-theme align-middle" id="summaryTable">
          <thead>
           <tr>
            <th class="text-nowrap" data-sort="office" role="button">
             Office
             <i class="fa-solid fa-sort ms-1">
             </i>
            </th>
            <th class="text-nowrap" data-sort="candidate" role="button">
             Selection
             <i class="fa-solid fa-sort ms-1">
             </i>
            </th>
            <th class="text-nowrap">
             Timestamp
            </th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td>
             President
            </td>
            <td>
             Alex Johnson
            </td>
            <td data-iso="2025-03-20T09:10:00Z">
             Mar 20, 2025 09:10
            </td>
           </tr>
           <tr>
            <td>
             Vice-President
            </td>
            <td>
             Mia Chen
            </td>
            <td data-iso="2025-03-20T09:12:00Z">
             Mar 20, 2025 09:12
            </td>
           </tr>
           <tr>
            <td>
             Treasurer
            </td>
            <td>
             Samuel Ortiz
            </td>
            <td data-iso="2025-03-20T09:14:00Z">
             Mar 20, 2025 09:14
            </td>
           </tr>
           <tr>
            <td>
             Secretary
            </td>
            <td>
             Priya Patel
            </td>
            <td data-iso="2025-03-20T09:16:00Z">
             Mar 20, 2025 09:16
            </td>
           </tr>
           <tr>
            <td>
             Senate At-Large Seat 1
            </td>
            <td>
             Jordan Lee
            </td>
            <td data-iso="2025-03-20T09:19:00Z">
             Mar 20, 2025 09:19
            </td>
           </tr>
           <tr>
            <td>
             Measure A
            </td>
            <td>
             For
            </td>
            <td data-iso="2025-03-20T09:22:00Z">
             Mar 20, 2025 09:22
            </td>
           </tr>
          </tbody>
         </table>
         <div class="d-flex justify-content-between align-items-center small text-muted">
          <div>
           Showing 6 of 6 selections
          </div>
          <div>
           <i class="fa-regular fa-calendar me-1">
           </i>
           Ballot saved: Mar 20, 2025 09:22
          </div>
         </div>
        </div>
       </div>
       <!-- Acknowledgement -->
       <div class="mt-4 form-check">
        <input class="form-check-input" id="acknowledgeCheckbox" type="checkbox" value=""/>
        <label class="form-check-label" for="acknowledgeCheckbox">
         I confirm that I have reviewed my selections and understand that casting my vote is final.
        </label>
       </div>
       <!-- Error / Feedback placeholder -->
       <div class="alert alert-danger mt-3 d-none" id="inlineError" role="alert">
        <i class="fa-solid fa-circle-exclamation me-2">
        </i>
        <span id="inlineErrorText">
         An unexpected error occurred. Please try again.
        </span>
       </div>
      </div>
      <div class="card-footer d-flex justify-content-between flex-wrap gap-2">
       <button class="btn btn-light" id="goBackBtn">
        <i class="fa-solid fa-arrow-left me-1">
        </i>
        Change Selection
       </button>
       <button class="btn btn-primary" id="confirmVoteBtn">
        <span class="btn-label">
         Confirm My Vote
        </span>
        <span aria-hidden="true" class="spinner-border spinner-border-sm ms-2 d-none" role="status">
        </span>
       </button>
      </div>
     </div>
     <!-- Security Note -->
     <div class="alert alert-info mt-4" role="alert">
      <i class="fa-solid fa-shield-halved me-2">
      </i>
      Your vote is encrypted and transmitted securely. Do not close your browser during submission.
     </div>
    </div>
    <!-- Footer (Common Component) -->
    <footer class="app-footer-voter py-3 mt-auto">
     <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between">
      <div class="mb-2 mb-md-0">
       <a class="btn btn-outline-secondary btn-sm me-2" href="./voter_dashboard.html">
        <i class="fa-solid fa-house me-1">
        </i>
        Dashboard
       </a>
       <a class="btn btn-outline-secondary btn-sm" href="./voter_results.html">
        <i class="fa-solid fa-square-poll-horizontal me-1">
        </i>
        Results
       </a>
      </div>
      <div class="d-flex align-items-center">
       <img alt="Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/footlogo/36/18';" src="https://dsaishared.blob.core.windows.net/uxcceleratecontainer/projects/68bd9542e1229daa603ec466/logos/logo_94009328-59f7-426f-bafe-3182305ed5e5.webp" style="height:18px"/>
       <small class="me-3">
        © 2025 FaceID Voting
       </small>
       <a class="small me-3" href="./terms.html">
        Terms
       </a>
       <a class="small" href="./privacy.html">
        Privacy
       </a>
      </div>
     </div>
    </footer>
   </main>
  </div>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11">
  </script>
  <!-- Bootstrap 5 Bundle JS -->
  <script crossorigin="anonymous" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
  </script>
  <script>
   // Ensure Poppins applies on this page
document.documentElement.style.setProperty('--font-sans', "'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'");

const confirmBtn = document.getElementById('confirmVoteBtn');
const goBackBtn = document.getElementById('goBackBtn');
const ack = document.getElementById('acknowledgeCheckbox');
const spinner = confirmBtn.querySelector('.spinner-border');
const label = confirmBtn.querySelector('.btn-label');
const inlineError = document.getElementById('inlineError');
const inlineErrorText = document.getElementById('inlineErrorText');

function setSubmitting(isSubmitting) {
    if (isSubmitting) {
        confirmBtn.setAttribute('disabled', 'disabled');
        spinner.classList.remove('d-none');
        label.textContent = 'Submitting...';
    } else {
        confirmBtn.removeAttribute('disabled');
        spinner.classList.add('d-none');
        label.textContent = 'Confirm My Vote';
    }
}

function showInlineError(msg) {
    inlineErrorText.textContent = msg;
    inlineError.classList.remove('d-none');
}

function hideInlineError() {
    inlineError.classList.add('d-none');
}

// Simple table sort & filter
(function initSummaryTable() {
    const table = document.getElementById('summaryTable');
    const headers = table.querySelectorAll('thead th[data-sort]');
    const tbody = table.querySelector('tbody');
    let sortState = {
        key: '',
        dir: 1
    };

    headers.forEach(h => {
        h.addEventListener('click', () => {
            const key = h.getAttribute('data-sort');
            sortState.dir = sortState.key === key ? -sortState.dir : 1;
            sortState.key = key;
            const rows = Array.from(tbody.querySelectorAll('tr'));
            rows.sort((a, b) => {
                let av, bv;
                if (key === 'office') {
                    av = a.children[0].textContent.trim().toLowerCase();
                    bv = b.children[0].textContent.trim().toLowerCase();
                } else if (key === 'candidate') {
                    av = a.children[1].textContent.trim().toLowerCase();
                    bv = b.children[1].textContent.trim().toLowerCase();
                }
                return av.localeCompare(bv) * sortState.dir;
            });
            rows.forEach(r => tbody.appendChild(r));
        });
    });

    const filterInput = document.getElementById('summaryFilter');
    filterInput.addEventListener('input', () => {
        const q = filterInput.value.trim().toLowerCase();
        Array.from(tbody.querySelectorAll('tr')).forEach(tr => {
            const office = tr.children[0].textContent.toLowerCase();
            const cand = tr.children[1].textContent.toLowerCase();
            tr.style.display = (office.includes(q) || cand.includes(q)) ? '' : 'none';
        });
    });
})();

goBackBtn.addEventListener('click', () => {
    // Navigate back to ballot page; selections should be preserved by the app
    window.location.href = './ballot_page.html';
});

confirmBtn.addEventListener('click', async () => {
    hideInlineError();
    if (!ack.checked) {
        Swal.fire({
            icon: 'warning',
            title: 'Please confirm',
            text: 'You must acknowledge that casting your vote is final before proceeding.'
        });
        return;
    }

    // Confirm irreversible action
    const {
        isConfirmed
    } = await Swal.fire({
        icon: 'question',
        title: 'Cast your vote now?',
        html: '<div class="text-start">This action is final and cannot be changed.<br/>Ensure your selections are correct.</div>',
        showCancelButton: true,
        confirmButtonText: 'Yes, cast my vote',
        cancelButtonText: 'Review again',
    });
    if (!isConfirmed) return;

    setSubmitting(true);
    Swal.fire({
        title: 'Submitting your vote',
        html: 'Please wait while we securely record your ballot...',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });

    // Simulate API call
    try {
        await new Promise((res) => setTimeout(res, 1400));
        const success = Math.random() > 0.08; // 92% success simulation
        if (!success) throw new Error('Network timeout. Please try again.');
        Swal.close();
        window.location.href = './vote_confirmation.html';
    } catch (err) {
        Swal.close();
        showInlineError(err.message || 'Failed to submit your vote.');
        Swal.fire({
            icon: 'error',
            title: 'Submission failed',
            text: err.message || 'Please try again.'
        });
    } finally {
        setSubmitting(false);
    }
});
  </script>
 </body>
</html>
