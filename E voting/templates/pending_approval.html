<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Registration Pending Approval • FaceID Voting
  </title>
  <!-- Brand typography: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Font Awesome 6 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
   <!-- App global theme CSS -->
   <link href="static/style.css" rel="stylesheet">
    <!-- Page specific CSS -->
    <link href="static/pending_approval.css" rel="stylesheet"/>
    <!-- SweetAlert2 CSS (optional; JS includes styles too) -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.12.4/dist/sweetalert2.min.css" rel="stylesheet"/>
    <!-- Shared/Public Header styles (kept consistent across pages) -->
    <style>
     .app-header-shared{background:#6144a6;color:#fff}
    .app-header-shared .navbar-brand,.app-header-shared .nav-link,.app-header-shared .dropdown-toggle{color:#fff}
    .app-header-shared .nav-link:hover,.app-header-shared .dropdown-item:hover{opacity:.9}
    </style>
    <!-- Shared/Public Footer styles (kept consistent across pages) -->
    <style>
     .app-footer{background:#f8f9fa;border-top:1px solid #eee;color:#555}
    .app-footer a{color:#6144a6;text-decoration:none}
    .app-footer a:hover{text-decoration:underline}
    </style>
   </link>
  </link>
 </head>
 <body>
  <div class="d-flex flex-column min-vh-100">
   <!-- Header (included: needed for public-facing status page) -->
   <nav class="navbar navbar-expand-lg navbar-dark app-header-shared shadow-sm">
    <div class="container-fluid">
     <a class="navbar-brand d-flex align-items-center" href="./index.html">
      <img alt="FaceID Voting" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/faceidlogo/64/28';" src="https://dsaishared.blob.core.windows.net/uxcceleratecontainer/projects/68bd9542e1229daa603ec466/logos/logo_94009328-59f7-426f-bafe-3182305ed5e5.webp" style="height:28px;"/>
      FaceID Voting
     </a>
     <button aria-controls="sharedNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#sharedNav" data-bs-toggle="collapse" type="button">
      <span class="navbar-toggler-icon">
      </span>
     </button>
     <div class="collapse navbar-collapse" id="sharedNav">
      <ul class="navbar-nav ms-auto align-items-center">
       <li class="nav-item me-2">
        <a class="btn btn-light btn-sm" href="./index.html">
         <i class="fa-solid fa-right-to-bracket me-1">
         </i>
         Login
        </a>
       </li>
       <li class="nav-item">
        <a class="btn btn-outline-light btn-sm" href="./registration_page.html">
         <i class="fa-solid fa-user-plus me-1">
         </i>
         Register
        </a>
       </li>
      </ul>
     </div>
    </div>
   </nav>
   <!-- Main Content -->
   <main class="flex-grow-1">
    <div class="container py-4 py-md-5">
     <!-- Breadcrumbs (subtle, optional) -->
     <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-4">
       <li class="breadcrumb-item">
        <a href="./registration_page.html">
         Register
        </a>
       </li>
       <li class="breadcrumb-item">
        <a href="./email_verification.html">
         Verify Email
        </a>
       </li>
       <li aria-current="page" class="breadcrumb-item active">
        Pending Approval
       </li>
      </ol>
     </nav>
     <!-- System feedback area -->
     <div class="alert alert-info d-none" id="systemFeedback" role="alert">
      <i class="fa-solid fa-circle-info me-2">
      </i>
      Status refreshed. Your account is still awaiting admin review.
     </div>
     <!-- Approval Status Notification (center focus) -->
     <section class="approval-wrapper d-flex align-items-center justify-content-center">
      <div aria-live="polite" class="app-card approval-panel text-center" role="status">
       <!-- StatusIcon -->
       <div aria-hidden="true" class="status-icon mx-auto mb-3">
        <i class="fa-regular fa-clock">
        </i>
       </div>
       <!-- StatusHeader -->
       <h1 class="page-title mb-2">
        Registration Pending Approval
       </h1>
       <!-- StatusMessageBody -->
       <p class="lead text-muted mb-3 mb-md-4" id="statusText">
        Thank you for registering. Your application is under review. We will email
        <strong id="userEmail">
         user@example.com
        </strong>
        as soon as your account is approved.
       </p>
       <!-- Optional progress indicator -->
       <div class="mx-auto mb-3" style="max-width:540px;">
        <div aria-label="Approval progress" aria-valuemax="100" aria-valuemin="0" class="progress" role="progressbar">
         <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 35%">
          Awaiting review
         </div>
        </div>
        <div class="small text-muted mt-2">
         Typical review time: within 24 hours
        </div>
       </div>
       <!-- NavigationAction -->
       <div class="d-grid d-sm-inline-flex justify-content-center gap-2">
        <a class="btn btn-light" href="#" id="refreshStatusBtn">
         <i class="fa-solid fa-rotate me-1">
         </i>
         Refresh Status
        </a>
        <a class="btn btn-primary" href="#" id="returnLoginBtn">
         <i class="fa-solid fa-arrow-left me-1">
         </i>
         Return to Login Page
        </a>
       </div>
       <!-- Meta info -->
       <div class="mt-4 small text-muted">
        <span class="me-2">
         <i class="fa-regular fa-id-badge me-1">
         </i>
         Request ID:
         <span id="requestId">
          REQ-841205
         </span>
        </span>
        <span>
         <i class="fa-regular fa-clock me-1">
         </i>
         Submitted:
         <span id="submittedAt">
          —
         </span>
        </span>
       </div>
      </div>
     </section>
    </div>
   </main>
   <!-- Footer (included: useful legal/support links) -->
   <footer class="app-footer py-3 mt-auto">
    <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between">
     <div class="d-flex align-items-center mb-2 mb-md-0">
      <img alt="Logo" class="me-2" onerror="this.onerror=null;this.src='https://picsum.photos/seed/faceidlogo/80/20';" src="https://dsaishared.blob.core.windows.net/uxcceleratecontainer/projects/68bd9542e1229daa603ec466/logos/logo_94009328-59f7-426f-bafe-3182305ed5e5.webp" style="height:20px"/>
      <small>
       © 2025 FaceID Voting
      </small>
     </div>
     <div class="d-flex gap-3">
      <a class="small" href="#" onclick="return false;">
       Terms
      </a>
      <a class="small" href="#" onclick="return false;">
       Privacy
      </a>
      <a class="small" href="#" onclick="return false;">
       Support
      </a>
     </div>
    </div>
   </footer>
  </div>
  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.12.4/dist/sweetalert2.all.min.js">
  </script>
  <!-- Bootstrap 5 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
  </script>
  <script>
   // Utility: format date/time
function formatDateTime(dt) {
    try {
        return new Intl.DateTimeFormat(undefined, {
            dateStyle: 'medium',
            timeStyle: 'short'
        }).format(dt);
    } catch (e) {
        return dt.toLocaleString();
    }
}

// Read email from query or storage
function resolveUserEmail() {
    const params = new URLSearchParams(window.location.search);
    const emailFromQuery = params.get('email');
    const stored = localStorage.getItem('registeredEmail') || localStorage.getItem('pendingEmail');
    const email = emailFromQuery || stored || 'user@example.com';
    // persist for refresh
    localStorage.setItem('pendingEmail', email);
    return email;
}

// Mock: request ID and submitted time
function ensureRequestMeta() {
    let reqId = sessionStorage.getItem('pendingRequestId');
    if (!reqId) {
        reqId = 'REQ-' + Math.floor(100000 + Math.random() * 899999);
        sessionStorage.setItem('pendingRequestId', reqId);
    }
    let ts = sessionStorage.getItem('pendingSubmittedAt');
    if (!ts) {
        ts = new Date().toISOString();
        sessionStorage.setItem('pendingSubmittedAt', ts);
    }
    return {
        reqId,
        ts: new Date(ts)
    };
}

function showSystemFeedback() {
    const el = document.getElementById('systemFeedback');
    if (!el) return;
    el.classList.remove('d-none');
    setTimeout(() => {
        el.classList.add('d-none');
    }, 4000);
}

function clearAuthSession() {
    // Clear common auth/session keys used in this demo
    const keys = ['jwtToken', 'authUser', 'pendingEmail', 'registeredEmail', 'pendingRequestId', 'pendingSubmittedAt'];
    keys.forEach(k => {
        localStorage.removeItem(k);
        sessionStorage.removeItem(k);
    });
}

document.addEventListener('DOMContentLoaded', () => {
    // Populate email and meta
    const email = resolveUserEmail();
    document.getElementById('userEmail').textContent = email;
    const {
        reqId,
        ts
    } = ensureRequestMeta();
    document.getElementById('requestId').textContent = reqId;
    document.getElementById('submittedAt').textContent = formatDateTime(ts);

    // Refresh Status handler (mock)
    document.getElementById('refreshStatusBtn').addEventListener('click', (e) => {
        e.preventDefault();
        Swal.fire({
            title: 'Checking status…',
            html: '<div class="text-muted small">Please wait while we contact the server.</div>',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });
        // Simulate network
        setTimeout(() => {
            // Keep as pending for this page; show feedback
            Swal.close();
            showSystemFeedback();
        }, 1200);
    });

    // Return to Login handler
    document.getElementById('returnLoginBtn').addEventListener('click', (e) => {
        e.preventDefault();
        Swal.fire({
            title: 'Return to Login?',
            text: 'This will clear your temporary session and redirect you to the login page.',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Yes, continue',
            cancelButtonText: 'Cancel',
            confirmButtonColor: '#6144a6'
        }).then(res => {
            if (res.isConfirmed) {
                clearAuthSession();
                Swal.fire({
                    title: 'Session cleared',
                    text: 'Redirecting to login…',
                    icon: 'success',
                    timer: 1100,
                    showConfirmButton: false
                });
                setTimeout(() => {
                    window.location.href = './index.html';
                }, 1050);
            }
        });
    });
});
  </script>
 </body>
</html>
